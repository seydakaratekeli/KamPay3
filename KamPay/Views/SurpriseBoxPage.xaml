<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:KamPay.ViewModels"
             xmlns:res="clr-namespace:KamPay.Services"
             x:DataType="vm:SurpriseBoxViewModel"
             x:Class="KamPay.Views.SurpriseBoxPage"
             Title="{Binding Source={x:Static res:LocalizationResourceManager.Instance}, Path=[SurpriseBoxTitle]}"
             Shell.BackgroundColor="#4CAF50">

    <Grid>
        <ScrollView>
            <Grid RowDefinitions="Auto,*,Auto" 
                  Padding="20" 
                  RowSpacing="20">

                <!-- ðŸ”¥ ÃœST BÃ–LÃœM: Puan GÃ¶stergesi -->
                <Frame Grid.Row="0"
                       BackgroundColor="#4CAF50" 
                       CornerRadius="20" 
                       Padding="20,15"
                       HasShadow="True"
                       HorizontalOptions="Center">
                    <HorizontalStackLayout Spacing="15">
                        <Label Text="ðŸ’°" 
                               FontSize="32"
                               VerticalOptions="Center"/>
                        <VerticalStackLayout Spacing="2">
                            <Label Text="{Binding Source={x:Static res:LocalizationResourceManager.Instance}, Path=[CurrentPoints]}" 
                                   FontSize="12" 
                                   TextColor="White"
                                   Opacity="0.9"/>
                            <Label Text="{Binding UserPoints}" 
                                   FontSize="28" 
                                   FontAttributes="Bold"
                                   TextColor="White"/>
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </Frame>

                <!-- ðŸ”¥ ORTA BÃ–LÃœM: Ana Ä°Ã§erik -->
                <VerticalStackLayout Grid.Row="1"
                                     VerticalOptions="Center"
                                     HorizontalOptions="Center"
                                     Spacing="25">

                    <!-- Kutu Resmi -->
                    <Frame Padding="20"
                           CornerRadius="100"
                           BackgroundColor="White"
                           HasShadow="True"
                           HorizontalOptions="Center">
                        <Image x:Name="BoxImage"
                               Source="gift_box.png" 
                               WidthRequest="150"
                               HeightRequest="150">
                            <Image.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding RedeemBoxCommand}" />
                            </Image.GestureRecognizers>
                        </Image>
                    </Frame>

                    <!-- BaÅŸlÄ±k -->
                    <Label Text="ðŸŽ SÃ¼rpriz Kutu!"
                           FontSize="32"
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center"
                           TextColor="#333"/>

                    <!-- AÃ§Ä±klama -->
                    <Frame BackgroundColor="#FFF3E0"
                           BorderColor="#FF9800"
                           CornerRadius="15"
                           Padding="20"
                           Margin="0">
                        <Label Text="{Binding Source={x:Static res:LocalizationResourceManager.Instance}, Path=[SurpriseBoxDescription]}"
                               FontSize="16"
                               HorizontalTextAlignment="Center"
                               TextColor="#F57C00"
                               LineHeight="1.5"/>
                    </Frame>

                    <!-- ðŸ”¥ SonuÃ§ Frame'i (Dinamik) -->
                    <Frame x:Name="ResultFrame"
                           IsVisible="False"
                           Opacity="0"
                           Padding="20"
                           CornerRadius="20"
                           BorderColor="#4CAF50"
                           BackgroundColor="White"
                           HasShadow="True"
                           Margin="0,10">
                        <VerticalStackLayout Spacing="15">
                            <!-- Tebrik BaÅŸlÄ±ÄŸÄ± -->
                            <Label Text="{Binding Source={x:Static res:LocalizationResourceManager.Instance}, Path=[Congratulations]}"
                                   FontSize="28"
                                   FontAttributes="Bold"
                                   TextColor="#4CAF50"
                                   HorizontalTextAlignment="Center"/>

                            <!-- ÃœrÃ¼n Resmi -->
                            <Frame Padding="0"
                                   CornerRadius="15"
                                   IsClippedToBounds="True"
                                   HasShadow="False"
                                   BorderColor="#E0E0E0">
                                <Image Source="{Binding RedemptionResult.ThumbnailUrl}"
                                       HeightRequest="200"
                                       Aspect="AspectFill"/>
                            </Frame>

                            <!-- ÃœrÃ¼n AdÄ± -->
                            <Label Text="{Binding RedemptionResult.Title}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   HorizontalTextAlignment="Center"
                                   TextColor="#333"/>

                            <!-- BaÅŸarÄ± MesajÄ± -->
                            <Label Text="{Binding SuccessMessage}"
                                   FontSize="14"
                                   TextColor="#666"
                                   HorizontalTextAlignment="Center"
                                   LineHeight="1.4"
                                   Margin="10,0"/>

                            <!-- Buton -->
                            <Button Text="{Binding Source={x:Static res:LocalizationResourceManager.Instance}, Path=[ViewMyProduct]}"
                                    Clicked="CloseResult_Clicked"
                                    BackgroundColor="#4CAF50"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    CornerRadius="25"
                                    HeightRequest="50"
                                    Margin="0,10,0,0"/>
                        </VerticalStackLayout>
                    </Frame>

                </VerticalStackLayout>

                <!-- ðŸ”¥ ALT BÃ–LÃœM: Hata ve Buton -->
                <VerticalStackLayout Grid.Row="2" 
                                     Spacing="15">

                    <!-- Hata MesajÄ± -->
                    <Frame IsVisible="{Binding HasError}"
                           BackgroundColor="#FFEBEE"
                           BorderColor="#F44336"
                           CornerRadius="10"
                           Padding="15"
                           Margin="0">
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="âš ï¸" 
                                   FontSize="20"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding ErrorMessage}"
                                   FontSize="14"
                                   TextColor="#C62828"
                                   VerticalOptions="Center"
                                   HorizontalOptions="FillAndExpand"
                                   LineBreakMode="WordWrap"/>
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- Yetersiz Puan UyarÄ±sÄ± -->
                    <Frame IsVisible="{Binding UserPoints, Converter={StaticResource LessThan100Converter}}"
                           BackgroundColor="#FFF3E0"
                           BorderColor="#FF9800"
                           CornerRadius="10"
                           Padding="15"
                           Margin="0">
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="ðŸ’¡" 
                                   FontSize="20"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding Source={x:Static res:LocalizationResourceManager.Instance}, Path=[InsufficientPoints]}"
                                   FontSize="13"
                                   TextColor="#F57C00"
                                   VerticalOptions="Center"
                                   HorizontalOptions="FillAndExpand"
                                   LineBreakMode="WordWrap"/>
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- ðŸ”¥ Ana Buton (HasShadow kaldÄ±rÄ±ldÄ±) -->
                    <Frame HasShadow="True"
                           CornerRadius="30"
                           Padding="0"
                           BackgroundColor="Transparent"
                           BorderColor="Transparent">
                        <Button Command="{Binding RedeemBoxCommand}"
                                Text="{Binding Source={x:Static res:LocalizationResourceManager.Instance}, Path=[OpenBoxFor100Points]}"
                                IsEnabled="{Binding CanRedeem}"
                                HeightRequest="60"
                                BackgroundColor="#4CAF50"
                                TextColor="White"
                                FontAttributes="Bold"
                                FontSize="18"
                                CornerRadius="30" />
                    </Frame>

                </VerticalStackLayout>

            </Grid>
        </ScrollView>

        <!-- ðŸ”¥ Loading Overlay -->
        <Grid IsVisible="{Binding IsLoading}"
              BackgroundColor="#80000000"
              InputTransparent="False">
            <VerticalStackLayout VerticalOptions="Center"
                                 HorizontalOptions="Center"
                                 Spacing="20">
                <ActivityIndicator IsRunning="True"
                                   Color="White"
                                   WidthRequest="60"
                                   HeightRequest="60" />
                <Label Text="{Binding Source={x:Static res:LocalizationResourceManager.Instance}, Path=[OpeningBox]}"
                       TextColor="White"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center"/>
            </VerticalStackLayout>
        </Grid>
    </Grid>

</ContentPage>